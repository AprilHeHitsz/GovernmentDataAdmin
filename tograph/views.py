from django.contrib.auth.decorators import login_required
from django.shortcuts import render
from django.db.models import Count
from django.http import JsonResponse

from pyecharts.charts import Graph
from pyecharts import options as opts
# Create your views here.
from django.http import HttpResponse
from django.template.loader import get_template

from event.views import filter_model
from event.models import Community, SubType, Type, MainType, Event, \
    Street, District, DisposeUnit, Property, EventSource, Achieve

import kgraph.views as kgv
import time


def show(request):
    return HttpResponse("hello")


@login_required(login_url='/user/login/')
def crawl(request):
    data_num = request.GET.get('data_num')
    print("----------------time:" + str(time) + "-------------------")
    data_all = ["@ç¬¬ä¸€çŽ°åœº @æ·±åœ³å¸‚åŸŽå¸‚ç®¡ç†å’Œç»¼åˆæ‰§æ³•å±€ @æ·±åœ³èº«è¾¹äº‹@æ·±åœ³å…¬å®‰ @æ·±åœ³æ–°é—»æ’­æŠ¥"
                " èƒ½ä¸èƒ½ç®¡ç®¡äº†ï¼Œæ¯å¤©æ™šä¸Šè¿™æ ·åŸŽå¸‚ä½œä¸šè½¦åœ¨æ¥¼ä¸‹ä½œä¸šï¼Œä»Ž12ç‚¹å¼€å§‹ä¸€ç›´åˆ°1ç‚¹å¤šï¼Œ"
                "æœ‰æ—¶åˆ°ä¸¤ç‚¹ã€‚æŠ•è¯‰æ— æ•°æ¬¡äº†ï¼Œæ¯æ¬¡éƒ½è¯´å¤„ç†ï¼Œç»“æžœåˆ°çŽ°åœ¨ä¹Ÿæ²¡æœ‰è§£å†³ï¼Œ"
                "æ€Žä¹ˆè€ç™¾å§“è·Ÿæ”¿åºœéƒ¨é—¨æ‰“äº¤é“å°±è¿™ä¹ˆå¿ƒç´¯å‘¢ï¼Ÿè€Œä¸”æ‰€è°“çš„ç¦ç”°åŸŽç®¡æ ¹æœ¬ä¸å¹²æ´»ï¼Œ"
                "ä¸Šç­æ—¶é—´æ‰“ç”µè¯éƒ½æ˜¯æ— äººæŽ¥å¬çš„ï¼Œè¿˜å·ç§°9-18ç‚¹ä¸Šç­ï¼Œäººå‘¢ï¼Ÿæ‹¿é’±ä¸å¹²æ´»ï¼Ÿ"
                " 2æ·±åœ³Â·é¦™æ™¯å¤§åŽ¦ Oç½‘é¡µé“¾æŽ¥ æ”¶èµ·å…¨æ–‡"
                "ä»Šå¤©09:44  æ¥è‡ª iPhoneå®¢æˆ·ç«¯",
                "@æ·±åœ³å¸‚åœºç›‘ç®¡ @æ·±åœ³å¸‚æ¶ˆè´¹è€…å§”å‘˜ä¼š @æ·±åœ³å¾®åšå‘å¸ƒåŽ…å‘æ·±åœ³æ”¿åºœèŒèƒ½éƒ¨é—¨æŠ•è¯‰ä¸ª"
                "åˆ«å…¬å¸çš„å¸‚åœºæ¬ºè¯ˆè¡Œä¸ºï¼Œç«‹å³å¾—ç§¯æžå“åº”ï¼Œå¸‚åœºç›‘ç£å±€ï¼ˆæ‰€ï¼‰çš„é¢†å¯¼å¤šæ¬¡åˆ°å•†å®¶åå•†"
                "ï¼Œä¸Žæˆ‘ç”µè¯æ²Ÿé€šã€‚è‡³æ­¤ï¼Œé—®é¢˜å·²åœ†æ»¡ è§£å†³ï¼æ„Ÿè°¢æ”¿åºœèŒèƒ½éƒ¨é—¨ï¼Œä¸ºç™¾å§“ç€æƒ³ï¼Œ"
                "å·¥ä½œè½å®žåˆ°å®žå¤„ï¼Œè¿™æ‰æ˜¯å…ˆè¡Œç¤ºèŒƒçœŸæœ‰åº”æœ‰é£Žé‡‡ï¼ä¸ºä½ ä»¬ç‚¹èµžï¼ "
                "11æœˆ23æ—¥ 14:57  æ¥è‡ª iPhoneå®¢æˆ·ç«¯",
                "ä¸€çœ‹åˆ°çš‡å²—å£å²¸é™„è¿‘æœ‰æ–½å·¥é¡¹ç›®å°±å¤´çš®å‘éº»ï¼Œæ‹œæ‰˜ä½ ä»¬ä¹Ÿå…³æ³¨ä¸€ä¸‹çš‡å²—å£å²¸çš„æ–½å·¥æ‰°æ°‘å§"
                "ã€‚[äºŒå“ˆ][äºŒå“ˆ][äºŒå“ˆ] æ˜¼å¤œä¸åœï¼Œå™ªéŸ³è¶…æ ‡ï¼ŒæŠ•è¯‰å°±æ˜¯æ²¡ç®¡ä¸äº†ï¼Œç®¡äº†ä¹Ÿæ˜¯æ²¡æ•ˆæžœï¼Œ"
                "ç„¶åŽå¹²è„†ä¸å›žåº” @æ·±åœ³ç‰¹åŒºæŠ¥ ä¸è®©è¯„è®ºåªèƒ½è‰¾ç‰¹ä½ äº†"
                "11æœˆ24æ—¥ 18:28 æ¥è‡ª å¾®åš weibo.com",
                "#æ·±åœ³ç”Ÿæ´»##æ·±åœ³èº«è¾¹äº‹# æ·±åœ³2020å¹´å™ªéŸ³æ‰°æ°‘æ ‡å‡†ï¼Œç»™äº†æ–½å·¥æ‰°æ°‘æ—¶é—´ï¼Œæ—©ä¸Šä¸ƒç‚¹å°±å¯ä»¥æ–½å·¥"
                "ï¼Œä¸”å…¨å¹´æ— ä¼‘ï¼Œä¼‘æ¯æ—¥æ›´ç”šï¼æ·±åœ³åˆ°å¤„åœ¨ä¿®è·¯ï¼Œæ—§æ”¹ï¼Œå¾ˆå¤šåŸŽä¸­æ‘åœ¨æ–½å·¥ï¼ˆåŒ…æ‹¬æœ¬äººæ‰€åœ¨å°åŒºï¼‰ï¼Œ"
                "ä¸”æ²¡æœ‰é™å™ªæŽªæ–½ï¼Œæ¯å¤©éƒ½è¢«æ–½å·¥å™ªéŸ³æƒŠé†’ï¼ŒæŠ•è¯‰å›žå¤æ­¤ç±»æ–½å·¥æ²¡æœ‰å·¥ä½œæ—¥å’Œä¼‘æ¯æ—¥ä¹‹åˆ†ï¼Œ"
                "æƒ³è¯·é—®æ·±åœ³äººå±…å§”ï¼Œä½ ä»¬å®šè¿™ä¸ªæ–½å·¥æ—¶é—´æ ‡å‡†æ˜¯å¦åˆç†æœ‰æ•ˆï¼Ÿï¼Ÿï¼Ÿç›‘ç£æŠ•è¯‰æ˜¯å¦æŒ‰æ ‡å‡†æœ‰æ•ˆå¤„ç†ï¼Ÿï¼Ÿï¼Ÿ"
                "@æ–°æµªæ·±åœ³ @æ·±åœ³æ–°é—»ç½‘ @æ·±åœ³èº«è¾¹äº‹ @æ·±åœ³äººå±…å§” @æ·±åœ³äººå±…çŽ¯å¢ƒå§” 2æ·±åœ³Â·ä¸‰è”å±±å’€å¤´å°åŒº "
                "æ”¶èµ·å…¨æ–‡d"
                "11æœˆ21æ—¥ 09:39  æ¥è‡ª è£è€€8X",
                "æ¥æ·±åœ³ä¸¤å¹´å¤š[doge]å¯¹è¿™ä¸ªåŸŽå¸‚çš„å¥½æ„Ÿå› ä¸ºâ€œå®œåœè½¦â€è¿™ä¸ªè¾£é¸¡appå…¨æ— [æ‹œæ‹œ]è¿™ä¸ªè½¯ä»¶ç®€ç›´æ˜¯é’“é±¼æ‰§æ³•çš„å¥½å¸®æ‰‹"
                "[å¾®ç¬‘]å¯¹å¼‚åœ°ç‰Œè½¦çš„æ¶æ„å†™å¾—æ˜Žæ˜Žç™½ç™½[éª·é«…]æŠ•è¯‰æ— ç”¨ç”³è¯‰æ— é—¨[è·ªäº†]è¿™è¿åå¸¸ç†å’Œæ­£å¸¸é€»è¾‘"
                "çš„è§„å®šç®€ç›´ä¸ºåˆ›æ”¶è€Œè®¾ðŸ˜Šæ¥äº†å°±æ˜¯æ·±åœ³äºº[è´¹è§£]ä¸äº†ä¸äº†æˆ‘ä¸é…[å“ˆæ¬ ]"
                "æœ€åŽå†è¯´ä¸€å¥æ·±åœ³äº¤å§”ä¸æ„§æ˜¯å®[å¾®ç¬‘]"
                "è’¸çš„è¾£é¸¡[å¯çˆ±] æ”¶èµ·å…¨æ–‡d"
                "11æœˆ21æ—¥ 06:27  æ¥è‡ª å¾®åšå›½é™…ç‰ˆ"
                ]

    data = data_all[0:int(data_num)]
    context = {
        'data': data,
        'datalength': data_num,

    }
    return JsonResponse(context)


def part(request):
    data_num = request.GET.get('data_num')
    data_all = [['@', 'ç¬¬ä¸€', 'çŽ°åœº', '@', 'æ·±åœ³å¸‚', 'åŸŽå¸‚', 'ç®¡ç†', 'å’Œ', 'ç»¼åˆ', 'æ‰§æ³•å±€', '@', 'æ·±åœ³', 'èº«è¾¹', 'äº‹', '@', 'æ·±åœ³', 'å…¬å®‰', '@',
                  'æ·±åœ³', 'æ–°é—»', 'æ’­æŠ¥', 'èƒ½', 'ä¸'
                                         'èƒ½', 'ç®¡ç®¡', 'äº†', 'æ¯å¤©æ™šä¸Š', 'è¿™æ ·', 'åŸŽå¸‚', 'ä½œä¸š', 'è½¦', 'åœ¨', 'æ¥¼ä¸‹', 'ä½œä¸š', 'ä»Ž', '12', 'ç‚¹',
                  'å¼€å§‹', 'ä¸€ç›´', 'åˆ°', '1', 'ç‚¹å¤š', 'æœ‰æ—¶', 'åˆ°', 'ä¸¤ç‚¹', 'ã€‚',
                  'æŠ•è¯‰', 'æ— æ•°æ¬¡', 'äº†', 'æ¯æ¬¡', 'éƒ½', 'è¯´', 'å¤„ç†', 'ç»“æžœ', 'åˆ°', 'çŽ°åœ¨', 'ä¹Ÿ', 'æ²¡æœ‰', 'è§£å†³', 'æ€Žä¹ˆ', 'è€ç™¾å§“', 'è·Ÿ', 'æ”¿åºœéƒ¨é—¨',
                  'æ‰“äº¤é“', 'å°±', 'è¿™ä¹ˆ', 'å¿ƒç´¯', 'å‘¢'
                                          '', 'è€Œä¸”', 'æ‰€è°“', 'çš„', 'ç¦ç”°', 'åŸŽç®¡', 'æ ¹æœ¬', 'ä¸', 'å¹²æ´»', 'ä¸Šç­æ—¶é—´', 'æ‰“ç”µè¯', 'éƒ½', 'æ˜¯',
                  'æ— äºº', 'æŽ¥å¬', 'çš„', 'è¿˜', 'å·ç§°', '9', '-', '18', 'ç‚¹', 'ä¸Šç­', 'ï¼Œ'
                                                                         'äºº', 'å‘¢', 'æ‹¿', 'é’±', 'ä¸', 'å¹²æ´»', '2', 'æ·±åœ³', 'Â·',
                  'é¦™æ™¯', 'å¤§åŽ¦', 'O', 'ç½‘é¡µ', 'é“¾æŽ¥', 'æ”¶èµ·', 'å…¨æ–‡', 'ä»Šå¤©', '09', ':', '44', 'æ¥è‡ª',
                  ' ', 'iPhone', 'å®¢æˆ·ç«¯'],
                 ['@', 'æ·±åœ³', 'å¸‚åœºç›‘ç®¡', '@', 'æ·±åœ³å¸‚', 'æ¶ˆè´¹è€…', 'å§”å‘˜ä¼š', '@', 'æ·±åœ³', 'å¾®åš', 'å‘å¸ƒåŽ…', 'å‘', 'æ·±åœ³', 'æ”¿åºœ', 'èŒèƒ½éƒ¨é—¨', 'æŠ•è¯‰',
                  'ä¸ªåˆ«', 'å…¬å¸', 'çš„', 'å¸‚åœº', 'æ¬ºè¯ˆ',
                  'è¡Œä¸º', 'ç«‹å³', 'å¾—', 'ç§¯æžå“åº”', 'å¸‚åœº', 'ç›‘ç£å±€', 'ï¼ˆ', 'æ‰€', 'ï¼‰', 'çš„', 'é¢†å¯¼', 'å¤šæ¬¡', 'åˆ°', 'å•†å®¶', 'åå•†', 'ä¸Ž', 'æˆ‘', 'ç”µè¯',
                  'æ²Ÿé€š', 'ã€‚', 'è‡³æ­¤', 'é—®é¢˜'
                                   '', 'å·²', 'åœ†æ»¡', 'è§£å†³', 'ï¼', 'æ„Ÿè°¢', 'æ”¿åºœ', 'èŒèƒ½éƒ¨é—¨', 'ä¸º', 'ç™¾å§“', 'ç€æƒ³', 'å·¥ä½œ', 'è½å®ž', 'åˆ°', 'å®žå¤„',
                  'è¿™æ‰', 'æ˜¯', 'å…ˆè¡Œ', 'ç¤ºèŒƒ', 'çœŸæœ‰', 'åº”æœ‰', 'é£Ž'
                                                     'é‡‡', 'ï¼', 'ä¸º', 'ä½ ä»¬', 'ç‚¹èµž', 'ï¼', '11', 'æœˆ', '23', 'æ—¥', '14', ':',
                  '57', 'æ¥è‡ª', 'iPhone', 'å®¢æˆ·ç«¯'],
                 ['ä¸€', 'çœ‹åˆ°', 'çš‡å²—', 'å£å²¸', 'é™„è¿‘', 'æœ‰', 'æ–½å·¥', 'é¡¹ç›®', 'å°±', 'å¤´çš®å‘éº»', 'æ‹œæ‰˜', 'ä½ ä»¬', 'ä¹Ÿ', 'å…³æ³¨', 'ä¸€ä¸‹', 'çš‡å²—', 'å£å²¸',
                  'çš„', 'æ–½å·¥', 'æ‰°æ°‘', 'å§', 'ã€‚', '[', 'äºŒå“ˆ',
                  ']', '[', 'äºŒå“ˆ', ']', '[', 'äºŒå“ˆ', ']', 'æ˜¼å¤œ', 'ä¸åœ', 'å™ªéŸ³', 'è¶…æ ‡', 'æŠ•è¯‰', 'å°±æ˜¯', 'æ²¡', 'ç®¡ä¸äº†', 'ç®¡', 'äº†', 'ä¹Ÿ',
                  'æ˜¯', 'æ²¡', 'æ•ˆæžœ', 'ç„¶åŽ',
                  'å¹²è„†', 'ä¸', 'å›žåº”', '@', 'æ·±åœ³ç‰¹åŒº', 'æŠ¥', 'ä¸è®©', 'è¯„è®º', 'åªèƒ½', 'è‰¾ç‰¹', 'ä½ ', 'äº†', '11', 'æœˆ', '24', 'æ—¥', '18', ':',
                  '28', 'æ¥è‡ª', 'å¾®åš', 'weibo',
                  '.', 'com'],
                 ['#', 'æ·±åœ³', 'ç”Ÿæ´»', '##', 'æ·±åœ³', 'èº«è¾¹', 'äº‹', '#', 'æ·±åœ³', '2020', 'å¹´', 'å™ªéŸ³', 'æ‰°æ°‘', 'æ ‡å‡†', 'ç»™', 'äº†', 'æ–½å·¥',
                  'æ‰°æ°‘', 'æ—¶é—´', 'æ—©ä¸Š', 'ä¸ƒç‚¹', 'å°±', 'å¯ä»¥',
                  'æ–½å·¥', 'ä¸”', 'å…¨å¹´', 'æ— ä¼‘', 'ä¼‘æ¯æ—¥', 'æ›´', 'ç”š', 'ï¼', 'æ·±åœ³', 'åˆ°å¤„', 'åœ¨', 'ä¿®è·¯', 'æ—§æ”¹', 'å¾ˆå¤š', 'åŸŽä¸­æ‘', 'åœ¨', 'æ–½å·¥', 'ï¼ˆ',
                  'åŒ…æ‹¬', 'æœ¬äºº', 'æ‰€åœ¨',
                  'å°åŒº', 'ï¼‰', 'ä¸”', 'æ²¡æœ‰', 'é™å™ª', 'æŽªæ–½', 'æ¯å¤©', 'éƒ½', 'è¢«', 'æ–½å·¥', 'å™ªéŸ³', 'æƒŠé†’', 'æŠ•è¯‰', 'å›žå¤', 'æ­¤ç±»', 'æ–½å·¥', 'æ²¡æœ‰',
                  'å·¥ä½œæ—¥', 'å’Œ', 'ä¼‘æ¯æ—¥', 'ä¹‹åˆ†',
                  'æƒ³', 'è¯·é—®', 'æ·±åœ³', 'äºº', 'å±…å§”', 'ä½ ä»¬', 'å®š', 'è¿™ä¸ª', 'æ–½å·¥', 'æ—¶é—´', 'æ ‡å‡†', 'æ˜¯å¦', 'åˆç†', 'æœ‰æ•ˆ', 'ç›‘ç£', 'æŠ•è¯‰', 'æ˜¯å¦',
                  'æŒ‰', 'æ ‡å‡†', 'æœ‰æ•ˆ', 'å¤„ç†', '@', 'æ–°æµª', 'æ·±åœ³',
                  '@', 'æ·±åœ³', 'æ–°é—»ç½‘', '@', 'æ·±åœ³', 'èº«è¾¹', 'äº‹', '@', 'æ·±åœ³', 'äºº', 'å±…å§”', '@', 'æ·±åœ³', 'äººå±…', 'çŽ¯å¢ƒ', 'å§”', '2',
                  'æ·±åœ³', 'Â·', 'ä¸‰è”', 'å±±å’€', 'å¤´', 'å°åŒº', 'æ”¶èµ·', 'å…¨æ–‡', 'd11', 'æœˆ', '21', 'æ—¥', '09', ':', '39', 'æ¥è‡ª', 'è£è€€',
                  '8X'],
                 ['æ¥', 'æ·±åœ³', 'ä¸¤å¹´', 'å¤š', '[', 'doge', ']', 'å¯¹', 'è¿™ä¸ª', 'åŸŽå¸‚', 'çš„', 'å¥½æ„Ÿ', 'å› ä¸º', 'â€œ', 'å®œ', 'åœè½¦', 'â€', 'è¿™ä¸ª',
                  'è¾£é¸¡', 'app', 'å…¨æ— ', '[', 'æ‹œæ‹œ', ']', 'è¿™ä¸ª', 'è½¯ä»¶',
                  'ç®€ç›´', 'æ˜¯', 'é’“é±¼', 'æ‰§æ³•', 'çš„', 'å¥½å¸®æ‰‹', '[', 'å¾®ç¬‘', ']', 'å¯¹', 'å¼‚åœ°', 'ç‰Œè½¦', 'çš„', 'æ¶æ„', 'å†™å¾—', 'æ˜Žæ˜Žç™½ç™½', '[',
                  'éª·é«…', ']', 'æŠ•è¯‰', 'æ— ç”¨', 'ç”³è¯‰', 'æ— é—¨', '[', 'è·ª', 'äº†'
                     , ']', 'è¿™', 'è¿åå¸¸ç†', 'å’Œ', 'æ­£å¸¸', 'é€»è¾‘', 'çš„', 'è§„å®š', 'ç®€ç›´', 'ä¸º', 'åˆ›æ”¶', 'è€Œè®¾', 'ï¿½', 'æ¥', 'äº†', 'å°±æ˜¯', 'æ·±åœ³',
                  'äºº', '[', 'è´¹è§£', ']', 'ä¸äº†', 'ä¸äº†', 'æˆ‘', 'ä¸é…', '[',
                  'å“ˆæ¬ ', ']', 'æœ€åŽ', 'å†è¯´', 'ä¸€å¥', 'æ·±åœ³', 'äº¤å§”', 'ä¸æ„§', 'æ˜¯', 'å®', '[', 'å¾®ç¬‘', ']', 'è’¸', 'çš„', 'è¾£é¸¡', '[', 'å¯çˆ±',
                  ']', 'æ”¶èµ·', 'å…¨æ–‡', 'd11', 'æœˆ', '21', 'æ—¥', '06'
                     , ':', '27', 'æ¥è‡ª', 'å¾®åš', 'å›½é™…ç‰ˆ']]

    data = data_all[0:int(data_num)]
    context = {
        'data': data,
        'datalength': data_num,
    }
    time.sleep(1)
    return JsonResponse(context)


def table(request):
    data_num = request.GET.get('data_num')

    data_all = [["2020/11/29", "ç¦ç”°åŒº é¦™æ™¯å¤§åŽ¦", "æ·±åœ³å¸‚åŸŽå¸‚ç®¡ç†å’Œç»¼åˆæ‰§æ³•å±€", "æŠ•è¯‰", "æ™šä¸ŠåŸŽå¸‚ä½œä¸šè½¦åœ¨æ¥¼ä¸‹ä½œä¸š"],
                 ["2020/11/23", " ", "å¸‚åœºç›‘ç£å±€", "æ„Ÿè°¢", "æŠ•è¯‰ç§¯æžå“åº”"],
                 ["2020/11/24", "çš‡å²—å£å²¸é™„è¿‘", " ", "æŠ•è¯‰", "æ–½å·¥æ‰°æ°‘", "å™ªéŸ³è¶…æ ‡"],
                 ["2020/11/21", "ä¸‰è”å±±å’€å¤´å°åŒº", "æ·±åœ³äººå±…å§”", "æŠ•è¯‰", "æ–½å·¥ æ²¡æœ‰é™å™ªæŽªæ–½"],
                 ["2020/11/21s", " ", "æ·±åœ³äº¤å§”", "æŠ•è¯‰", "å®œåœè½¦ é’“é±¼æ‰§æ³•"]]

    data = data_all[0:int(data_num)]
    print(data)
    context = {
        'data': data,

        'datalength': data_num,
    }
    return JsonResponse(context)


def get_graph(request):
    # data_num = request.GET.get('data_num')
    data_all = [["2020/11/29", "ç¦ç”°åŒº é¦™æ™¯å¤§åŽ¦", "æ·±åœ³å¸‚åŸŽå¸‚ç®¡ç†å’Œç»¼åˆæ‰§æ³•å±€", "æŠ•è¯‰", "æ™šä¸ŠåŸŽå¸‚ä½œä¸šè½¦åœ¨æ¥¼ä¸‹ä½œä¸š"],
            ["2020/11/23", " ", "å¸‚åœºç›‘ç£å±€", "æ„Ÿè°¢", "æŠ•è¯‰ç§¯æžå“åº”"],
            ["2020/11/24", "çš‡å²—å£å²¸é™„è¿‘", " ", "æŠ•è¯‰", "æ–½å·¥æ‰°æ°‘", "å™ªéŸ³è¶…æ ‡"],
            ["2020/11/21", "ä¸‰è”å±±å’€å¤´å°åŒº", "æ·±åœ³äººå±…å§”", "æŠ•è¯‰", "æ–½å·¥ æ²¡æœ‰é™å™ªæŽªæ–½"],
            ["2020/11/21", " ", "æ·±åœ³äº¤å§”", "æŠ•è¯‰", "å®œåœè½¦ é’“é±¼æ‰§æ³•"]]

    data = data_all

    cate = ["æ—¶é—´", "åœ°ç‚¹", "éƒ¨é—¨", "æ€§è´¨", "äº‹ä»¶"]

    link_value = ["å‘ç”Ÿæ—¶é—´", "å‘ç”Ÿåœ°ç‚¹", "è´£ä»»éƒ¨é—¨", "äº‹ä»¶æ€§è´¨", "äº‹ä»¶æœ¬èº«"]

    categories_all = []
    nodes_all = []
    links_all = []
    nodes_name = []

    node_index = 0

    for record in data:
        categories = []
        nodes = []
        links = []
        for c in cate:
            print("cate:" + c + "\n")
            categories.append(opts.GraphCategory(name=c))

        for anode, i in zip(record, range(0, len(cate))):
            print("node:" + anode + "\n")
            if anode == " ":
                pass
            else:
                if is_node_exist(nodes_name, anode) == -1:
                    nodes.append(opts.GraphNode(name=anode, symbol_size=80, category=i))
                    nodes_name.append(anode)
                    node_index += len(nodes_name) - 1
                else:
                    node_index = is_node_exist(nodes_name, anode)

        for anode, i in zip(record, range(0, len(link_value) - 1)):
            print("link:" + record[4] + "->" + link_value[i] + "->" + record[i] + "\n")
            if anode == record[4]:
                pass
            else:
                links.append(opts.GraphLink(source=record[4], target=anode, value=link_value[i]))

        categories_all = categories_all + categories
        nodes_all = nodes_all + nodes
        links_all = links_all + links

    page = "graph"
    kgraph = to_graph(categories_all, nodes_all, links_all)

    context = {
        'graph': kgraph,
        "page": page,
        'cur_page': "kgraph",
    }
    return render(request, 'tograph/tograph.html', context)


def to_graph(categories, nodes, links) -> Graph:
    c = (
        Graph(
            init_opts=opts.InitOpts(width="1600px", height="800px")
        )
            .add(
            "",
            nodes=nodes,
            links=links,
            categories=categories,
            gravity=0.01,
            repulsion=300,
            linestyle_opts=opts.LineStyleOpts(color="black", curve=0.2),
            label_opts=opts.LabelOpts(is_show=True, position='inside', font_size=15),
            is_draggable=True,
            is_rotate_label=True,
            is_focusnode=True,
            layout="force",
            edge_length=200,
            edge_label=opts.LabelOpts(
                is_show=True,
                position="middle",
                font_size=15,
                formatter="{c}"
            ),
            edge_symbol=[None, 'arrow']
        )
            .set_global_opts(
            legend_opts=opts.LegendOpts(is_show=True),
            title_opts=opts.TitleOpts(),
        )
            .dump_options_with_quotes()
    )

    return c


def is_node_exist(nodes, node):
    if node in set(nodes):
        return nodes.index(node)

    else:
        return -1
